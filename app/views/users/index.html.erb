<% @users.each do |user| %>
  <% if user != current_user %>

    <div class="media col-md-4">
      <div class="media-left media-middle">
        <a href="users/<%= user.id %>">
          <%= user_gravatar(user, 75) %>
        </a>
      </div>
      <div class="media-body">
        <h4 class="media-heading"><%= user.name %></h4>
        <span class="add-<%= user.id %>">
          <% if current_user.friendship?(user) %>
            <%= link_to "Cancel Friendship", friendship_path(current_user.get_friendship_id(user)), remote: true, method: :delete, class: "btn btn-danger" %>
          <% elsif current_user.invitation?(user) %>
            <% if current_user.has_invited?(user) %>
              <%= link_to "Cancel Friendship", friendship_path(current_user.get_friendship_id(user)), remote: true, method: :delete, class: "btn btn-danger" %>
            <% else %>
            <%= link_to "Accept Invitation", friendship_path(current_user.get_friendship_id(user)), remote: true, method: :patch, class: "btn btn-success" %>
            <% end %>
          <% else %>
            <%= link_to "Request Friendship", friendships_path(friendship:  {invited_friend_id: user.id } ), remote: true, method: :post, class: "btn btn-primary" %>
          <% end %>
        </span>
      </div>
    </div>

  <% end %>
    
<% end %>
